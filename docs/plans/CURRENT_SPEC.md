# 機能要件定義: 新規予約のスマートフォン通知機能

## 1. 目的
キャンプ場の新規予約（またはキャンセル）がメールからスプレッドシートに自動抽出・書き込みされたタイミングで、施設の管理者・スタッフのスマートフォンへ即座に通知を送信し、予約の見逃しや対応漏れを防ぐ。

## 2. 仕様 (提案)
通知のアプローチとして、スマートフォンへの到達率が高く、運用が容易な **LINE（LINE Messaging API）** の利用をメインに想定。

### 通知のタイミング
- 抽出スクリプト (`gmail_to_sheets.js` 内の `extractAllPlatformEmails` 処理) の実行時
- 新しい**「確定メール」** または **「キャンセルメール」** を検出し、シートに新しい行として反映した「直後」

### データ構造/メッセージフォーマット
通知される内容は、抽出したデータを用いて簡潔に構成します。

**【新規予約の場合】**
```
📩 新規予約が入りました [楽天]
---------------------
予約ID: C001-XXXXX
名前: 山田 太郎 様
日程: 2026/02/25 〜 02/26
サイト: Aサイト (1区画)
人数: 大人2, 子供1
料金: 6,000円
```

**【キャンセルの場合】**
```
⚠️ 予約キャンセル [なっぷ]
---------------------
予約ID: NAPRSV-XXXXX
対象のお客さまのステータスを「キャンセル済み」に変更しました。
```

### 必要な設定項目 (config.jsに追加)
```javascript
notifier: {
  USE_LINE: true, // 通知を有効にするか
  ACCESS_TOKEN: 'LINEのアクセストークン', // (※スクリプトプロパティで隠蔽管理を推奨)
  USER_ID: '送信先となるLINEユーザーID または グループID'
}
```

## 3. 検証方法
- `debug_tool.js` 内に通知送信用テスト関数を追加し、ダミーデータでLINEにメッセージが届くかを確認する。
- 実際の予約抽出フローで新規予約が検出された際、エラーなくシートへの書き込みが行われ、同時にLINEにメッセージが送信されることを確認する。

## 4. ユーザー様にご確認・ご準備いただきたい点 (レビュー・承認事項)
- **通知ツールの選定**: LINEでよろしいでしょうか？（Slack、Chatwork、Discord、あるいは指定メールアドレスへの転送等の別手段をご希望の場合はお知らせください）。
- ※旧来の「LINE Notify」機能は2025年3月にサービス終了するため、これを利用する場合は「LINE公式アカウント（LINE Messaging API）」を開設していただく必要がございます（手順はご案内します）。
